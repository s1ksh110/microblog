{% extends "base.html" %}

{% block content %}
  <h1>Latest Posts</h1>

  {% for post in posts %}
    <div>
      <h3>{{ post.title }}</h3>
      <p>{{ post.content | markdown }}</p>
      <small>By {{ post.author.username }} on {{ post.timestamp.strftime('%Y-%m-%d') }}</small>

      {% if post.tags %}
        <p>
          Tags:
          {% for tag in post.tags %}
            <a href="{{ url_for('tag_filter', tag_name=tag.name) }}">{{ tag.name }}</a>{% if not loop.last %}, {% endif %}
          {% endfor %}
        </p>
      {% endif %}

      {% if current_user.is_authenticated and current_user == post.author %}
        <p>
          <a href="{{ url_for('edit_post', post_id=post.id) }}">Edit</a> |
          <form method="post"
                action="{{ url_for('delete_post', post_id=post.id) }}"
                style="display:inline;"
                onsubmit="return confirm('Are you sure you want to delete this post?');">
            <button type="submit">Delete</button>
          </form>
        </p>
      {% endif %}
    </div>
    <hr>
  {% endfor %}

  {% if pagination %}
    <div>
      {% if pagination.has_prev %}
        <a href="{{ url_for('index', page=pagination.prev_num) }}">Previous</a>
      {% endif %}

      <span>Page {{ pagination.page }}</span>

      {% if pagination.has_next %}
        <a href="{{ url_for('index', page=pagination.next_num) }}">Next</a>
      {% endif %}
    </div>
  {% endif %}

{% endblock %}
